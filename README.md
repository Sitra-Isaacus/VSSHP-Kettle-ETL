# VSSHP-Kettle-ETL

Suuri osa Kliinisen tietopalvelun (KTP) työtä on potilastietojen kerääminen eri tietojärjestelmistä yhdeksi fyysiseksi ja toisaalta harmonisoiduksi kokonaisuudeksi. Data kerätään eri palvelimilta erilaisista tietomuodoista tällä hetkellä yhteen PostgreSQL-tietokantaan, jossa sitä voidaan käyttää saumattomasti yhdessä. ETL on toeteutettu Pentaho Data Integration -ohjelmalla.

Data tuodaan eri lähdejärjestelmistä erilaisin tekniikoin. Yleensä, kun lähdejärjestelmä on relaatiokanta, käytetään JDBC-lukuyhteyttä suoraan lähdekantaan. Poiminnoissa suositaan ns. raportointikantoja, koska suoraan operatiivisesta potilastietojärjestelmästä lukeminen aiheuttaa kuormitusta järjestelmälle ja saattaa joissain tapauksissa vaikuttaa järjestelmän käytettävyyteen potilaiden hoidossa. Raportointikannoissa tätä riskiä ei ole. Raportointikantojen päivittymissykli taas vaihtelee lähes reaaliaikaisesta (esim. Uranus ODS) viikon välein päivittyviin (esim. LabDW). Osa tietolähteistä on alun perin raportointikäyttöön tarkoitettuja järjestelmiä, kuten Medbitin DataVault-tietovarasto, josta haetaan mm. leikkaus-, kuvantamis- ja taloustietoja. Osa lähteistä taas on varta vasten KTP:tä ajatellen toimittajilta tilattuja tuotteita, kuten QPatin XML-rajapinta ja kuvantamisen lausuntotekstien poiminta Radusta.

ETL-skripti (esim. update_all.kjb) ajetaan kerran vuorokaudessa, ja se hakee uudet ja muuttuneet potilastiedot lähdejärjestelmistä ja lisää tai päivittää ne KTP:n PostgreSQL-tietokannan lastauslaiturille. Skripti on rakennettu modulaarisesti, ja osa palasista on tiedon harmonisointi- ja suodatusoperaatioita, jotka tuottavat KTP:n jokapäiväisessä poiminta- ja analyysityössä käytetyt taulut ja näkymät. Palasten kehitys ja testaus tapahtuu erillään kokonaisuudesta testiympäristössä, ja kehitettyjä palasia on helppo lisätä tuotantokokonaisuuteen sitä mukaa kun niitä valmistuu.

Lisää asiasta dokumentaatiossa [VSSHP-tietoallas-dap](https://github.com/Sitra-Isaacus/VSSHP-tietoallas-dap)